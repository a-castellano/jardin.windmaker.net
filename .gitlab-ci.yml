image: registry.windmaker.net:5005/a-castellano/limani/base_hugo:latest

stages:
    - build
    - deploy

build:
  stage: build
  script:
    - hugo
  artifacts:
    name: "build-$CI_PIPELINE_ID"
    paths:
      - public
    expire_in: 10 minutes

deploy:
  stage: deploy
  before_script:
    - mkdir .ssh
    - cat ${PRIVATE_SSH_KEY} > .ssh/id_rsa.pub
    - chmod 400 .ssh/id_rsa.pub
  script:
    - rsync -a --delete public/ ${SSH_USER}@${SSH_HOST}:${DOC_ROOT}/
  dependencies:
  - build

